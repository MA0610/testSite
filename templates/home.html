
{% extends "base.html" %}
{% block title %}Add Courses{% endblock %}

{% block content %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Class Schedule</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="main-container">
        <div class="addCourse">
            <h2>New Course</h2>
            <div class="add-course">
                <label for="new-course">Name:</label>
                <input type="text" id="new-course" placeholder="Enter valid course">
            </div>

            <div class="addProfessor">
                <label for="professor-name">Email:</label>
                <input type="text" id="professor-name" placeholder="Enter professor email">
            </div>

       

            <div class="time-selector">
                <label>Class Section: </label>
                <input type="text" id="class_section" placeholder="ex. 0">
                <button id="add-course-btn">Add Course</button>
            </div>
            <h2>Available Classes</h2>

            <!-- Creation of Class Search Bar -->
            <div class="search-container">
                <label for="search">Search Classes:</label>
                <input type="text" id="search" placeholder="Search by class name or code...">
            </div>
        
            <div class="scrollable-classes" id="available-classes">
                <!-- <div class="class" draggable="true" data-class="Math 101">Math 101 (e.g.)</div> -->
            </div>
        
            <div class="trash-bin droppable" id="trash-bin">
                Drop here to remove from schedule
            </div>

            <!-- Creation of Submit Button and Clear Database Button -->
            <button type="button" id="submitButton">Submit Schedule</button>  

            <button type="button" id="clearDatabaseButton">Clear Schedule</button>
            <br></br>

            <h3>Directions</h3>
            <p1>1. Create a course by entering the info, once down press the "Add Course" button.
                <b>IMPORTANT:</b> Refreshing the page will remove the classes created (won't remove from schedule once submitted but will no longer be on the page and will have to be created again).
            </p1>
            
            <br><br>
            <p1>2. The course will appear in the Available Classes container where you can then drop it in to the corresponding time slot.
                <b>IMPORTANT:</b> You can only save one class per time slot at a time (ex. Chemistry 101 and Physics 101 can't both be added to 8:00-9:25 am MW at the same time), you will have to press submit and then remove the course by dragging it into the red dropzone listed below the class container.
            </p1>
            <br><br>
            <p1>3. Once all courses have been put into their time slots press the "Submit Schedule" button to save your schedule (website will not send this to the registar) where you can view it in Display Schedule which is on the Navigation Bar at the top of the page.</p1>
            <br><br>
            <br><br>
            <br><br>

        </div>  

         
        <!-- Time slots -->
        <div class="content">
            <div class="schedule">
                <div class="day droppable" data-day="Monday">
                    <h3>Monday</h3>
                    
                    <div class="time-slot droppable" data-time-slot="0" day-set="MW" data-days="8:00-9:25 am">8:00-9:25 am MW</div>
                    <div class="time-slot droppable" data-time-slot="1" day-set="MF" data-days="8:00-9:25 am">8:00-9:25 am MF</div>
                    <div class="time-slot droppable" data-time-slot="2" day-set="MWF" data-days="8:30-9:25 am">8:30-9:25 am MWF</div>
                    <div class="time-slot droppable" data-time-slot="3" day-set="M-F" data-days="8:30-9:25 am">8:30-9:25 am M-F</div>
                    <div class="time-slot droppable" data-time-slot="4" day-set="MWF" data-days="9:35-10:30 am">9:35-10:30 am MWF</div>
                    <div class="time-slot droppable" data-time-slot="5" day-set="MWF" data-days="10:40-11:35 am">10:40-11:35 am MWF</div>
                    <div class="time-slot droppable" data-time-slot="6" day-set="MWF" data-days="11:45-12:40 pm">11:45-12:40 pm MWF</div>
                    <div class="time-slot droppable" data-time-slot="7" day-set="MWF" data-days="1:55-2:50 pm">1:55-2:50 pm MWF</div>
                    <div class="time-slot droppable" data-time-slot="8" day-set="M-F" data-days="1:55-2:50 pm">1:55-2:50 pm M-F</div>
                    <div class="time-slot droppable" data-time-slot="9" day-set="MWF" data-days="3:00-3:55 pm">3:00-3:55 pm MWF</div>
                    <div class="time-slot droppable" data-time-slot="10" day-set="M-LAB" data-days="3:00-5:55 pm">3:00-5:55 pm M-LAB</div>
                    <div class="time-slot droppable" data-time-slot="11" day-set="MWF" data-days="4:05-5:00 pm">4:05-5:00 pm MWF</div>
                    <div class="time-slot droppable" data-time-slot="12" day-set="MW" data-days="4:05-5:30 pm">4:05-5:30 pm MW</div>
                    <div class="time-slot droppable" data-time-slot="13" day-set="MF" data-days="4:05-5:30 pm">4:05-5:30 pm MF</div>
                    <div class="time-slot droppable" data-time-slot="14" day-set="MW" data-days="5:40-7:05 pm">5:40-7:05 pm MW</div>
                    <div class="time-slot droppable" data-time-slot="15" day-set="MW" data-days="7:15-8:40 pm">7:15-8:40 pm MW</div>
                    <div class="time-slot droppable" data-time-slot="16" day-set="M-LAB" data-days="7:15-10:10 pm">7:15-10:10 pm M</div>
                    <div class="time-slot droppable" data-time-slot="17" day-set="MW" data-days="8:50-10:15 pm">8:50-10:15 pm MW</div>
             
                </div>
                    
                <div class="day droppable" data-day="Tuesday">
                    <h3>Tuesday</h3>

                    <div class="time-slot droppable" data-time-slot="0" day-set="TR" data-days="8:30-9:55 am">8:30-9:55 am TR</div>
                    <div class="time-slot droppable" data-time-slot="1" day-set="T" data-days="8:30-11:55 am">8:30-11:55 am T</div>
                    <div class="time-slot droppable" data-time-slot="2" day-set="TR" data-days="10:05-11:30 am">10:05-11:30 am TR</div>
                    <div class="time-slot droppable" data-time-slot="3" day-set="TR" data-days="1:30-2:55 pm">1:30-2:55 pm TR</div>
                    <div class="time-slot droppable" data-time-slot="4" day-set="T" data-days="1:30-4:25 pm">1:30-4:25 pm T</div>
                    <div class="time-slot droppable" data-time-slot="5" day-set="T-LAB" data-days="1:30-4:25 pm">1:30-4:25 pm T-LAB</div>
                    <div class="time-slot droppable" data-time-slot="6" day-set="TR" data-days="3:05-4:30 pm">3:05-4:30 pm TR</div>
                    <div class="time-slot droppable" data-time-slot="7" day-set="TR" data-days="5:00-6:25 pm">5:00-6:35 pm TR</div>
                    <div class="time-slot droppable" data-time-slot="8" day-set="T" data-days="7:15-10:15 pm">7:15-10:15 pm T</div>


                </div>
                    
                <div class="day droppable" data-day="Wednesday">
                    <h3>Wednesday</h3>


                    <div class="time-slot droppable" data-time-slot="0" day-set="WF" data-days="8:00-9:25 am">8:00-9:25 am WF</div>
                    <div class="time-slot droppable" data-time-slot="1" day-set="W-LAB" data-days="1:55-4:50 pm">1:55-4:50 pm W-LAB</div>
                    <div class="time-slot droppable" data-time-slot="2" day-set="W-LAB" data-days="3:00-5:55 pm">3:00-5:55 pm W-LAB</div>
                    <div class="time-slot droppable" data-time-slot="3" day-set="WF" data-days="4:05-5:30 pm">4:05-5:30 pm WF</div>
                    <div class="time-slot droppable" data-time-slot="4" day-set="W-LAB" data-days="7:15-10:10 pm">7:15-10:10 pm W-LAB</div>
                    <div class="time-slot droppable" data-time-slot="5" day-set="W" data-days="7:15-10:15 pm">7:15-10:15 pm W-LAB</div>

                </div>
                    
                <div class="day droppable" data-day="Thursday">
                    <h3>Thursday</h3>

                    <div class="time-slot droppable" data-time-slot="0" day-set="R-LAB" data-days="8:30-11:25 am">8:30-11:25 am R-LAB</div>
                    <div class="time-slot droppable" data-time-slot="1" day-set="R" data-days="1:30-4:25 pm">1:30-4:25 pm R</div>
                    <div class="time-slot droppable" data-time-slot="2" day-set="R-LAB" data-days="1:30-4:25 pm">1:30-4:25 pm R-LAB</div>
                    <div class="time-slot droppable" data-time-slot="3" day-set="R-LAB" data-days="7:15-10:10 pm">7:15-10:10 pm R-LAB</div>
                    <div class="time-slot droppable" data-time-slot="4" day-set="R" data-days="7:15-10:15 pm">7:15-10:15 pm R</div>

                
                </div>
                    
                <div class="day droppable" data-day="Friday">
                    <h3>Friday</h3>

                    <div class="time-slot droppable" data-time-slot="0" day-set="F-LAB" data-days="1:55-4:50 pm">1:55-4:50 pm F-LAB</div>

                </div>
                <br></br>
                <br></br>
  
            </div>
        </div>   
        
    <script>



// Event listener to make add course work
document.getElementById('add-course-btn').addEventListener('click', () => {
        const courseName = document.getElementById('new-course').value;
        const professorName = document.getElementById('professor-name').value;
        const sectionNumber = document.getElementById('class_section').value;
        

        const newClass = document.createElement('div');
        newClass.classList.add('class');
        newClass.setAttribute('draggable', 'true');
        newClass.setAttribute('data-class', courseName);
        newClass.setAttribute('professor-name',professorName);
        newClass.setAttribute('class_section', sectionNumber);


        newClass.textContent = `${courseName} ${sectionNumber} (${professorName})`;
        
        newClass.addEventListener('dragstart', () => newClass.classList.add('dragging'));
        newClass.addEventListener('dragend', () => newClass.classList.remove('dragging'));

        document.getElementById('available-classes').appendChild(newClass);

        // Clear the form inputs
        document.getElementById('new-course').value = '';
        document.getElementById('professor-name').value = '';
        document.getElementById('class_section').value = '';

    });






        const trashBin = document.getElementById('trash-bin');
        const availableClassesContainer = document.getElementById('available-classes');
        const submitButton = document.getElementById('submitButton');

        const draggables = document.querySelectorAll('.class');
        const droppableTimeSlots = document.querySelectorAll('.time-slot');



   // Define a mapping of day sets to their corresponding days
   const daySetMapping = {
            'MF': ['Monday', 'Friday'],
            'MW': ['Monday', 'Wednesday'],
            'MWF': ['Monday', 'Wednesday', 'Friday'],
            'M-F': ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'],
            'TR': ['Tuesday', 'Thursday']
        };


        // Dragging functionality
        draggables.forEach(draggable => {
            draggable.addEventListener('dragstart', () => {
                draggable.classList.add('dragging');
            });

            draggable.addEventListener('dragend', () => {
                draggable.classList.remove('dragging');
            });
        });

        // Dropping functionality for time slots
        droppableTimeSlots.forEach(timeSlot => {
            timeSlot.addEventListener('dragover', (e) => {
                e.preventDefault();
            });

            timeSlot.addEventListener('drop', (e) => {
                e.preventDefault();
                const draggingElement = document.querySelector('.dragging');
                if (draggingElement) {
                    timeSlot.appendChild(draggingElement);
                }
            });
        });

 // Trash Bin Drop Functionality
trashBin.addEventListener('dragover', (e) => {
    e.preventDefault();
});

trashBin.addEventListener('drop', () => {
    const draggingElement = document.querySelector('.dragging');
    if (draggingElement) {
        const className = draggingElement.getAttribute('data-class');
        const day = draggingElement.closest('.day').getAttribute('data-day');
        const timeSlot = draggingElement.closest('.time-slot');
        availableClassesContainer.appendChild(draggingElement);
    }
});


// Clear Database Button Functionality
const clearDatabaseButton = document.getElementById('clearDatabaseButton');

clearDatabaseButton.addEventListener('click', () => {
    if (confirm('Are you sure you want to clear the database?')) {
        fetch('/clear_database', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Database cleared successfully!');
            } else {
                alert('Error clearing database: ' + data.message);
            }
        })
        .catch((error) => {
            console.error('Error:', error);
            alert('An error occurred while trying to clear the database.');
        });
    }
});






// Submit Button Functionality
submitButton.addEventListener('click', async () => {
    const days = document.querySelectorAll('.day');

    // Loop over each day
    for (let day of days) {
        const dayIndex = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"].indexOf(day.getAttribute('data-day'));
        const timeSlots = day.querySelectorAll('.time-slot');

        // Loop over each time slot for the day
        for (let index = 0; index < timeSlots.length; index++) {
            const slot = timeSlots[index];
            const classElement = slot.querySelector('.class');

            
            if (classElement) {
                // Create a new schedule array with the current day and time slot filled in
                const newScheduleData = Array.from({ length: 5 }, () => Array(20).fill(null)); 
                
                // Populate just the current slot's data
                newScheduleData[dayIndex][index] = [classElement.getAttribute('data-class')];

                // Collect additional data
                const daySetValue = slot.getAttribute('day-set');
                const timeValue = slot.getAttribute('data-days');
                const profName = classElement.getAttribute('professor-name');
                const sectionNumber = classElement.getAttribute('class_section');

                // Prepare the data for the POST request
                const requestData = {
                    schedule: newScheduleData, 
                    set: daySetValue,
                    time: timeValue,
                    professor: profName,
                    section: sectionNumber
                };

                try {
                    // Await the fetch request to ensure sequential execution
                    const response = await fetch('/schedule', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(requestData)
                    });

                    const data = await response.json();

                    if (data.success) {
                        console.log('Schedule for', day.getAttribute('data-day'), 'at time slot', index, 'submitted successfully!');
                    } else {
                        console.error('Error submitting schedule for', day.getAttribute('data-day'), 'at time slot', index, ':', data.message);
                    }
                } catch (error) {
                    console.error('Error during fetch:', error);
                }
            }
        }
    }

    // After all submissions are done, notify the user
    alert('All schedule submission(s) completed!');
});

// Class Search Event Listener 
document.getElementById('search').addEventListener('input', function () {
    const searchQuery = this.value.toLowerCase();  // Get the search query and convert to lowercase for case-insensitive search
    const courses = document.querySelectorAll('#available-classes .class'); // Get all course elements

    courses.forEach(course => {
        const courseName = course.getAttribute('data-class').toLowerCase(); // Get the course name (stored in data-class attribute)

        // If the course name contains the search query, show the course, otherwise hide it
        if (courseName.includes(searchQuery)) {
            course.style.display = '';  // Show the course
        } else {
            course.style.display = 'none';  // Hide the course
        }
    });
});
 



    </script>


</body>

{% endblock %}
