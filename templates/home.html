{% extends "base.html" %}
{% block title %}Class Schedule{% endblock %}

{% block content %}
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Class Schedule</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="main-container">
        <div class="addCourse">
            <h2>New Course</h2>
            <div class="add-course">
                <label for="new-course">Name:</label>
                <input type="text" id="new-course" placeholder="Enter valid course">
            </div>

            <div class="addProfessor">
                <label for="professor-name">Name:</label>
                <input type="text" id="professor-name" placeholder="Enter professor name">
            </div>

            <!-- <div class="day-selector">
                <label>Select Days: </label>
                <button class="day-button" data-days="MWF">MWF</button>
                <button class="day-button" data-days="TuTh">TuTh</button>
                <button class="day-button" data-days="MW">MW</button>
            </div> -->

            <div class="time-selector">
                <label>Class Section: </label>
                <input type="text" id="class_section" placeholder="ex. 0">
                <button id="add-course-btn">Add Course</button>
            </div>
            <h2>Available Classes</h2>
            <div class="search-container">
                <label for="search">Search Classes:</label>
                <input type="text" id="search" placeholder="Search by class name or code...">
            </div>
        
            <div class="scrollable-classes" id="available-classes">
                <div class="class" draggable="true" data-class="Math 101">Math 101 (e.g.)</div>
            </div>
        
            <div class="trash-bin droppable" id="trash-bin">
                Drop here to remove from schedule
            </div>

            <button type="button" id="submitButton">Submit Schedule</button>  
            <button type="button" id="clearDatabaseButton">Clear Database</button>
        </div>  
            
        <div class="content">
            <div class="schedule">
                <div class="day droppable" data-day="Monday">
                    <h3>Monday</h3>
                    <div class="time-slot droppable" data-time-slot="0" day-set="MW" data-days="8:00-9:25 am">8:00-9:25 am MW</div>
                    <div class="time-slot droppable" data-time-slot="1" day-set="MF" data-days="8:00-9:25 am">8:00-9:25 am MF</div>
                    <div class="time-slot droppable" data-time-slot="2" day-set="M-F" data-days="8:30-9:25 am">8:30-9:25 am M-F</div>
                    <div class="time-slot droppable" data-time-slot="3" day-set="MWF" data-days="8:30-9:25 am">8:30-9:25 am MWF</div>
                    <div class="time-slot droppable" data-time-slot="4" day-set="MWF" data-days="9:35-10:30 am">9:35-10:30 am MWF</div>
                    <div class="time-slot droppable" data-time-slot="5" day-set="MWF" data-days="10:40-11:35 am">10:40-11:35 am MWF</div>
                    <div class="time-slot droppable" data-time-slot="6" day-set="MWF" data-days="11:45-12:40 pm">11:45-12:40 pm MWF</div>
                    <div class="time-slot droppable" data-time-slot="7" day-set="M-F" data-days="1:55-2:50 pm">1:55-2:50 pm M-F</div>
                    <div class="time-slot droppable" data-time-slot="8" day-set="MWF" data-days="1:55-2:50 pm">1:55-2:50 pm MWF</div>
                    <div class="time-slot droppable" data-time-slot="9" day-set="MWF" data-days="1:55-2:50 pm">1:55-2:50 pm MWF</div>
                    <div class="time-slot droppable" data-time-slot="10" day-set="MWF" data-days="3:00-3:55 pm">3:00-3:55 pm MWF</div>
                    <div class="time-slot droppable" data-time-slot="11" day-set="M-LAB" data-days="3:00-5:55 pm">3:00-5:55 pm M-LAB</div>
                    <div class="time-slot droppable" data-time-slot="12" day-set="MWF" data-days="4:05-5:00 pm">4:05-5:00 pm MWF</div>
                    <div class="time-slot droppable" data-time-slot="13" day-set="MW" data-days="4:05-5:30 pm">4:05-5:30 pm MW</div>
                    <div class="time-slot droppable" data-time-slot="14" day-set="MF" data-days="4:05-5:30 pm">4:05-5:30 pm MF</div>
                    <div class="time-slot droppable" data-time-slot="15" day-set="MW" data-days="5:40-7:05 pm">5:40-7:05 pm MW</div>
                    <div class="time-slot droppable" data-time-slot="16" day-set="MW" data-days="7:15-8:40 pm">7:15-8:40 pm MW</div>
                    <div class="time-slot droppable" data-time-slot="17" day-set="M-LAB" data-days="7:15-10:10 pm">7:15-10:10 pm M-LAB</div>
                    <div class="time-slot droppable" data-time-slot="18" day-set="MW" data-days="8:50-10:15 pm">8:50-10:15 pm MW</div>
                </div>
                    
                <div class="day droppable" data-day="Tuesday">
                    <h3>Tuesday</h3>
                    <div class="time-slot droppable" data-time-slot="0" day-set="T" data-days="8:30-9:25 am">8:30-9:25 am T</div>
                    <div class="time-slot droppable" data-time-slot="1" day-set="TR" data-days="8:30-9:55 am">8:30-9:55 am TR</div>
                    <div class="time-slot droppable" data-time-slot="2" day-set="T" data-days="8:30-11:25 am">8:30-11:25 am T</div>
                    <div class="time-slot droppable" data-time-slot="3" day-set="T-LAB" data-days="8:30-11:25 am">8:30-11:25 am T-LAB</div>
                    <div class="time-slot droppable" data-time-slot="4" day-set="TR" data-days="10:05-11:30 am">10:05-11:30 am TR</div>
                    <div class="time-slot droppable" data-time-slot="5" day-set="TR" data-days="1:30-2:55 pm">1:30-2:55 pm TR</div>
                    <div class="time-slot droppable" data-time-slot="6" day-set="T" data-days="1:30-4:25 pm">1:30-4:25 pm T</div>
                    <div class="time-slot droppable" data-time-slot="7" day-set="T-LAB" data-days="1:30-4:25 pm">1:30-4:25 pm T-LAB</div>
                    <div class="time-slot droppable" data-time-slot="8" day-set="M-F" data-days="1:55-2:50 pm">1:55-2:50 pm M-F</div>
                    <div class="time-slot droppable" data-time-slot="9" day-set="TR" data-days="3:05-4:30 pm">3:05-4:30 pm TR</div>
                    <div class="time-slot droppable" data-time-slot="10" day-set="TR" data-days="5:00-6:25 pm">5:00-6:25 pm TR</div>
                    <div class="time-slot droppable" data-time-slot="11" day-set="T" data-days="7:15-10:15 pm">7:15-10:15 pm T</div>
                </div>
                    
                <div class="day droppable" data-day="Wednesday">
                    <h3>Wednesday</h3>
                    <div class="time-slot droppable" data-time-slot="0" day-set="MW" data-days="8:00-9:25 am">8:00-9:25 am MW</div>
                    <div class="time-slot droppable" data-time-slot="1" day-set="M-F" data-days="8:30-9:25 am">8:30-9:25 am M-F</div>
                    <div class="time-slot droppable" data-time-slot="2" day-set="MWF" data-days="8:30-9:25 am">8:30-9:25 am MWF</div>
                    <div class="time-slot droppable" data-time-slot="3" day-set="MWF" data-days="9:35-10:30 am">9:35-10:30 am MWF</div>
                    <div class="time-slot droppable" data-time-slot="4" day-set="MWF" data-days="10:40-11:35 am">10:40-11:35 am MWF</div>
                    <div class="time-slot droppable" data-time-slot="5" day-set="MWF" data-days="11:45-12:40 pm">11:45-12:40 pm MWF</div>
                    <div class="time-slot droppable" data-time-slot="6" day-set="M-F" data-days="1:55-2:50 pm">1:55-2:50 pm M-F</div>
                    <div class="time-slot droppable" data-time-slot="7" day-set="MWF" data-days="1:55-2:50 pm">1:55-2:50 pm MWF</div>
                    <div class="time-slot droppable" data-time-slot="8" day-set="MWF" data-days="1:55-2:50 pm">1:55-2:50 pm MWF</div>
                    <div class="time-slot droppable" data-time-slot="9" day-set="W-LAB" data-days="1:55-2:50 pm">1:55-2:50 pm W-LAB</div>
                    <div class="time-slot droppable" data-time-slot="10" day-set="MWF" data-days="3:00-3:55 pm">3:00-3:55 pm MWF</div>
                    <div class="time-slot droppable" data-time-slot="11" day-set="W-LAB" data-days="3:00-5:55 pm">3:00-5:55 pm W-LAB</div>
                    <div class="time-slot droppable" data-time-slot="12" day-set="MWF" data-days="4:05-5:00 pm">4:05-5:00 pm MWF</div>
                    <div class="time-slot droppable" data-time-slot="13" day-set="MW" data-days="4:05-5:30 pm">4:05-5:30 pm MW</div>
                    <div class="time-slot droppable" data-time-slot="15" day-set="MW" data-days="5:40-7:05 pm">5:40-7:05 pm MW</div>
                    <div class="time-slot droppable" data-time-slot="16" day-set="MW" data-days="7:15-8:40 pm">7:15-8:40 pm MW</div>
                    <div class="time-slot droppable" data-time-slot="17" day-set="W-LAB" data-days="7:15-10:10 pm">7:15-10:10 pm W-LAB</div>
                    <div class="time-slot droppable" data-time-slot="18" day-set="MW" data-days="8:50-10:15 pm">8:50-10:15 pm MW</div>
                </div>
                    
                <div class="day droppable" data-day="Thursday">
                    <h3>Thursday</h3>
                    <div class="time-slot droppable" data-time-slot="0" day-set="R" data-days="8:30-9:25 am">8:30-9:25 am R</div>
                    <div class="time-slot droppable" data-time-slot="1" day-set="TR" data-days="8:30-9:55 am">8:30-9:55 am TR</div>
                    <div class="time-slot droppable" data-time-slot="2" day-set="T" data-days="8:30-11:25 am">8:30-11:25 am T</div>
                    <div class="time-slot droppable" data-time-slot="3" day-set="R-LAB" data-days="8:30-11:25 am">8:30-11:25 am R-LAB</div>
                    <div class="time-slot droppable" data-time-slot="4" day-set="TR" data-days="10:05-11:30 am">10:05-11:30 am TR</div>
                    <div class="time-slot droppable" data-time-slot="5" day-set="TR" data-days="1:30-2:55 pm">1:30-2:55 pm TR</div>
                    <div class="time-slot droppable" data-time-slot="6" day-set="R" data-days="1:30-4:25 pm">1:30-4:25 pm R</div>
                    <div class="time-slot droppable" data-time-slot="7" day-set="R-LAB" data-days="1:30-4:25 pm">1:30-4:25 pm R-LAB</div>
                    <div class="time-slot droppable" data-time-slot="8" day-set="M-F" data-days="1:55-2:50 pm">1:55-2:50 pm M-F</div>
                    <div class="time-slot droppable" data-time-slot="9" day-set="TR" data-days="3:05-4:30 pm">3:05-4:30 pm TR</div>
                    <div class="time-slot droppable" data-time-slot="10" day-set="TR" data-days="5:00-6:25 pm">5:00-6:25 pm TR</div>
                    <div class="time-slot droppable" data-time-slot="11" day-set="R" data-days="7:15-10:15 pm">7:15-10:15 pm R</div>
                </div>
                    
                <div class="day droppable" data-day="Friday">
                    <h3>Friday</h3>
                    <div class="time-slot droppable" data-time-slot="0" day-set="MF" data-days="8:00-9:25 am">8:00-9:25 am MF</div>
                    <div class="time-slot droppable" data-time-slot="1" day-set="M-F" data-days="8:30-9:25 am">8:30-9:25 am M-F</div>
                    <div class="time-slot droppable" data-time-slot="2" day-set="MWF" data-days="8:30-9:25 am">8:30-9:25 am MWF</div>
                    <div class="time-slot droppable" data-time-slot="3" day-set="MWF" data-days="9:35-10:30 am">9:35-10:30 am MWF</div>
                    <div class="time-slot droppable" data-time-slot="4" day-set="MWF" data-days="10:40-11:35 am">10:40-11:35 am MWF</div>
                    <div class="time-slot droppable" data-time-slot="5" day-set="MWF" data-days="11:45-12:40 pm">11:45-12:40 pm MWF</div>
                    <div class="time-slot droppable" data-time-slot="6" day-set="M-F" data-days="1:55-2:50 pm">1:55-2:50 pm M-F</div>
                    <div class="time-slot droppable" data-time-slot="7" day-set="MWF" data-days="1:55-2:50 pm">1:55-2:50 pm MWF</div>
                    <div class="time-slot droppable" data-time-slot="8" day-set="MWF" data-days="1:55-2:50 pm">1:55-2:50 pm MWF</div>
                    <div class="time-slot droppable" data-time-slot="9" day-set="F-LAB" data-days="1:55-2:50 pm">1:55-2:50 pm F-LAB</div>
                    <div class="time-slot droppable" data-time-slot="10" day-set="MWF" data-days="3:00-3:55 pm">3:00-3:55 pm MWF</div>
                    <div class="time-slot droppable" data-time-slot="11" day-set="F-LAB" data-days="3:00-5:55 pm">3:00-5:55 pm F-LAB</div>
                    <div class="time-slot droppable" data-time-slot="12" day-set="MWF" data-days="4:05-5:00 pm">4:05-5:00 pm MWF</div>
                    <div class="time-slot droppable" data-time-slot="14" day-set="MF" data-days="4:05-5:30 pm">4:05-5:30 pm MF</div>
                    <div class="time-slot droppable" data-time-slot="17" day-set="F-LAB" data-days="7:15-10:10 pm">7:15-10:10 pm F-LAB</div>
                </div>
                    
            </div>
        </div>   
    <script>




document.getElementById('add-course-btn').addEventListener('click', () => {
        const courseName = document.getElementById('new-course').value;
        const professorName = document.getElementById('professor-name').value;
        const sectionNumber = document.getElementById('class_section').value;
        

        const newClass = document.createElement('div');
        newClass.classList.add('class');
        newClass.setAttribute('draggable', 'true');
        newClass.setAttribute('data-class', courseName);
        newClass.setAttribute('professor-name',professorName);
        newClass.setAttribute('class_section', sectionNumber);


        newClass.textContent = `${courseName} ${sectionNumber} (${professorName})`;
        
        newClass.addEventListener('dragstart', () => newClass.classList.add('dragging'));
        newClass.addEventListener('dragend', () => newClass.classList.remove('dragging'));

        document.getElementById('available-classes').appendChild(newClass);

        // Clear the form inputs
        document.getElementById('new-course').value = '';
        document.getElementById('professor-name').value = '';
        document.getElementById('class_section').value = '';

    });






        const trashBin = document.getElementById('trash-bin');
        const availableClassesContainer = document.getElementById('available-classes');
        const submitButton = document.getElementById('submitButton');

        const draggables = document.querySelectorAll('.class');
        const droppableTimeSlots = document.querySelectorAll('.time-slot');



   // Define a mapping of day sets to their corresponding days
   const daySetMapping = {
            'MF': ['Monday', 'Friday'],
            'MW': ['Monday', 'Wednesday'],
            'MWF': ['Monday', 'Wednesday', 'Friday'],
            'M-F': ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'],
            'TR': ['Tuesday', 'Thursday']
        };


        // Dragging functionality
        draggables.forEach(draggable => {
            draggable.addEventListener('dragstart', () => {
                draggable.classList.add('dragging');
            });

            draggable.addEventListener('dragend', () => {
                draggable.classList.remove('dragging');
            });
        });

        // Dropping functionality for time slots
        droppableTimeSlots.forEach(timeSlot => {
            timeSlot.addEventListener('dragover', (e) => {
                e.preventDefault();
            });

            timeSlot.addEventListener('drop', (e) => {
                e.preventDefault();
                const draggingElement = document.querySelector('.dragging');
                if (draggingElement) {
                    timeSlot.appendChild(draggingElement);
                }
            });
        });

 // Trash Bin Drop Functionality
trashBin.addEventListener('dragover', (e) => {
    e.preventDefault();
});

trashBin.addEventListener('drop', () => {
    const draggingElement = document.querySelector('.dragging');
    if (draggingElement) {
        const className = draggingElement.getAttribute('data-class');
        const day = draggingElement.closest('.day').getAttribute('data-day');
        const timeSlot = draggingElement.closest('.time-slot');
        availableClassesContainer.appendChild(draggingElement);
    }
});

const clearDatabaseButton = document.getElementById('clearDatabaseButton');

clearDatabaseButton.addEventListener('click', () => {
    if (confirm('Are you sure you want to clear the database?')) {
        fetch('/clear_database', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Database cleared successfully!');
            } else {
                alert('Error clearing database: ' + data.message);
            }
        })
        .catch((error) => {
            console.error('Error:', error);
            alert('An error occurred while trying to clear the database.');
        });
    }
});


       // Submit schedule functionality
   
submitButton.addEventListener('click', () => {
    const newScheduleData = Array.from({ length: 5 }, () => Array(20).fill(null)); // 5 days, 20 time slots
    const days = document.querySelectorAll('.day');

    days.forEach(day => {
        const dayIndex = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"].indexOf(day.getAttribute('data-day'));
        const timeSlots = day.querySelectorAll('.time-slot');

        timeSlots.forEach((slot, index) => {
            const classElement = slot.querySelector('.class');

            if (classElement) {
                if (!newScheduleData[dayIndex][index]) {
                    newScheduleData[dayIndex][index] = [];
                }
                newScheduleData[dayIndex][index].push(classElement.getAttribute('data-class'));

                // Collect the day-set value and time value
                const daySetValue = slot.getAttribute('day-set');
                const timeValue = slot.getAttribute('data-days');

                const profName = classElement.getAttribute('professor-name'); 
                const sectionNumber = classElement.getAttribute('class_section');

                // Send data including the professor's name
                fetch('/schedule', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 
                        schedule: newScheduleData, 
                        set: daySetValue, 
                        time: timeValue, 
                        professor: profName,
                        section: sectionNumber
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Schedule submitted successfully!');
                    } else {
                        alert('Error submitting schedule: ' + data.message);
                    }
                })
                .catch((error) => {
                    console.error('Error:', error);
                });
            }
        });
    });
});


    </script>
</body>
{% endblock %}
